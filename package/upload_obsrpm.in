#!/bin/sh

# srcdir=/shared/playproj/i2c
# workdir=.

name=@PACKAGE_TARNAME@ 
ver="@PACKAGE_VERSION@"

obs_proj="home:rockowitz"
obs_pkg=ddcutil

echo "arg 0: $0"
echo "arg 1: $1"
echo "arg 2: $2"
echo "number of arguments: $#"

if [[ $# -ge 2 ]]; then 
	obs_pkg=$2
fi

srcdir=${PWD}/..
curdir=${PWD}
workdir=${PWD}/obswork

echo srcdir=$srcdir
echo workdir=$workdir
echo obs_pkg=$obs_pkg

# TODO: error if workdir exists but not a directory

if [ ! -d $workdir ]; then
  echo creating $workdir
  mkdir $workdir
else
  echo clearing $workdir
  rm -r $workdir/*
  rm -r $workdir/.osc
fi

cmd="osc checkout -o $workdir $obs_proj $obs_pkg"
echo "cmd: $cmd"
$cmd

tar_fn=ddcutil-${ver}.tar.gz

tar_fn_new=
if [ -e $workdir/$tar_fn ]; then
  echo "$tar_fn already exists"
else 
  echo "$tar_fn not checked out"
  tar_fn_new=1
fi

# TODO: remove all prior versions 
cp -p $srcdir/$tar_fn $workdir
cp -p $curdir/ddcutil.spec $workdir

cd obswork

osc addremove 




# cp -p $srcdir/ddcutil-${ver}.tar.gz $workdir

# cp -p $srcdir/obs/ddcutil.spec $workdir

cmd="osc commit ddcutil-${ver}.tar.gz ddcutil.spec --message=\"new rpm build files\""
echo cmd: $cmd
$cmd

# osc rebuild
