#!/bin/sh
echo "(build_dpkg) executing"
echo $1
echo $2

export DEBFULLNAME="Sanford Rockowitz"
export DEBEMAIL="rockowitz@minsoft.com"

basename=ddcutil
rootdir=${PWD}/..
ver="@PACKAGE_VERSION@"
echo "PACKAGE_TARNAME: ${PACKAGE_TARNAME}"
echo "PACKAGE_VERSION: ${PACKAGE_VERSION}"
echo "basename: ${basename}"
echo "ver: ${ver}"
orig_tarball="${basename}-${ver}.tar.gz"
echo "orig_tarball: ${orig_tarball}"
if [ -e ${PWD}/debwork ]; then 
   echo "erasing debwork.."
   rm -r ${PWD}/debwork
fi
mkdir ${PWD}/debwork
cd debwork
cp -p ${rootdir}/${orig_tarball} .
tar -xzvf ${orig_tarball}
newname1="${basename}_${ver}.orig.tar.gz"
newname2=`echo ${orig_tarball} | sed -e s/tar.gz/orig.tar.gz/`
echo "newname1=$newname1"
echo "newname2=$newname2"
mv ${orig_tarball} ${newname1}

cd ${basename}-${ver}
# fails trying to chmod on package/obsrpm, which doesn't exist here since package 
# ./configure

# dh_make -f ../${orig_tarball} -c gpl2 -m -y --defaultless --addmissing
cp -pr ${rootdir}/package/debian .
# debuild

echo "(build_dpkg) Before debuild"

case "$1" in

debuild) echo "case debuild"
         debuild -us -uc -i -I
         ;;

pdebuild) echo "case pdebuild"
         pdebuild 
         ;;

ppa) echo "case ppa"
     debuild -S
     ;;


mentors) echo "case mentors"
     debuild -S -sa	
     ;;

obsdeb)  echo "case obsdeb"
     debuild -us -uc -I -i
     ;;

*) echo "case other"

esac

echo "(build_dpkg) Done"
